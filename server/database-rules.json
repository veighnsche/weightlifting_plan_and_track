{
  "rules": {
    ".read": "auth != null",
    ".write": "auth != null",
    "conversations": {
      "$conversationID": {
        ".validate": "newData.hasChildren(['messages'])",
        "messages": {
          "$messageID": {
            ".validate": "newData.hasChildren(['role', 'content', 'timestamp']) && (newData.child('role').val() === 'user' || newData.child('role').val() === 'assistant' || newData.child('role').val() === 'system')",
            "timestamp": {
              ".validate": "newData.isNumber() && newData.val() <= now"
            },
            "role": {
              ".validate": "newData.isString()"
            },
            "content": {
              ".validate": "newData.isString()"
            },
            "data": {
              ".validate": "newData.exists() ? !newData.isString() && !newData.isNumber() && !newData.isBoolean() : true"
            },
            "functionCall": {
              ".validate": "newData.exists() ? !newData.isString() && !newData.isNumber() && !newData.isBoolean() && newData.hasChildren(['functionName', 'parameters', 'metadata']) : true",
              "functionName": {
                ".validate": "newData.isString()"
              },
              "parameters": {
                ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()"
              },
              "metadata": {
                ".validate": "newData.hasChildren(['callback', 'status'])",
                "callback": {
                  ".validate": "newData.isString()"
                },
                "status": {
                  ".validate": "newData.isString() && (newData.val() === 'valid' || newData.val() === 'invalid' || newData.val() === 'replaced')"
                }
              }
            },
            "$other": {
              ".validate": "false"
            }
          }
        }
      }
    }
  }
}
